<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- T√≠tulo configur√°vel nas p√°ginas-filhas -->
  <title>
    {% block title %}LuftDocs{% endblock %}
  </title>

  <!-- Favicon padr√£o -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='assets/icon2.png') }}" type="image/png">
  <link rel="icon" href="{{ url_for('static', filename='assets/icon2.png') }}" sizes="32x32" type="image/png">

  <!-- CSS de terceiros -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.5/viewer.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">


  <style>
    :root {
      --font-small: 0.45rem;
      --font-medium: 1rem;
      --font-large: 1.5rem;
      --font-xlarge: 2rem;
      --card-bg: #fff;
      --card-color: #212529;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9fb;
      font-size: var(--font-medium);
      transition: background 0.3s, color 0.3s, font-size 0.3s;
    }
    body.theme-dark {
      background: #1e1e1e;
      color: #e7eaf1;
      --card-bg: #2b2b3a;
      --card-color: #e7eaf1;
    }
    /* Navbar clara */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fa; /* cor clara */
      padding: 18px 6vw;
      color: #23263b;
      box-shadow: 0 2px 12px #0001;
    }
    .logo-wiki {
      text-decoration: none;
      color: #23263b;
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: 1px;
      transition: color 0.13s;
    }
    .logo-wiki:hover {
      color: #0d6efd;
    }
    .main {
      padding: 36px 6vw;
      max-width: 1200px;
      margin: 0 auto;
    }
    /* Footer clara */
    .footer-LuftDocs {
      width: 100%;
      background: #f8f9fa; /* cor clara */
      color: #23263b;
      margin-top: 48px;
      padding: 28px 0 20px 0;
      text-align: center;
      box-shadow: 0 -2px 10px #0001;
    }
    .modulo-conteudo img,
    .modulo-conteudo video {
      max-width: 440px;
      width: 100%;
      height: auto;
      display: block;
      margin: 24px auto;
      border-radius: 12px;
      box-shadow: 0 2px 10px #0001;
      transition: box-shadow 0.18s, filter 0.16s;
      cursor: pointer;
    }
    .modulo-conteudo img:hover,
    .modulo-conteudo video:hover {
      box-shadow: 0 6px 24px #00b4d820, 0 2px 12px #0002;
      filter: brightness(1.04);
    }
    .card {
      background-color: var(--card-bg) !important;
      color: var(--card-color)  !important;
      transition: background-color 0.3s, color 0.3s;
    }
    /* nova regra para o utilit√°rio text-body */
    body.theme-dark .text-body {
      color: var(--card-color) !important;
    }
    
    /* ---------- Modal Configura√ß√µes (tema escuro) ---------- */
    body.theme-dark .modal-content {
      background-color: var(--card-bg) !important;
      color: var(--card-color) !important;
    }
    body.theme-dark .modal-header,
    body.theme-dark .modal-body,
    body.theme-dark .modal-footer {
      background-color: var(--card-bg) !important;
      color: var(--card-color) !important;
    }

    /* Nav-tabs escuros */
    body.theme-dark .nav-tabs .nav-link {
      background-color: #2b2b3a !important;
      color: var(--card-color) !important;
      border-color: #444 !important;
    }
    body.theme-dark .nav-tabs .nav-link.active {
      background-color: #3a3a4a !important;
    }

    /* Form controls */
    body.theme-dark .form-select,
    body.theme-dark .form-check-input {
      background-color: #1e1e1e !important;
      color: #e7eaf1 !important;
      border: 1px solid #444 !important;
    }
    body.theme-dark .form-check-label {
      color: var(--card-color) !important;
    }

    /* Bot√µes */
    body.theme-dark .btn-primary {
      background-color: #0056b3 !important;
      border-color: #004a99 !important;
    }
    body.theme-dark .btn-secondary {
      background-color: #444 !important;
      border-color: #555 !important;
    }

    @media (max-width: 900px) {
      .navbar { flex-direction: column; align-items: stretch; gap: 14px; padding: 14px 2vw; }
      .main   { padding: 18px 2vw; }
    }
    @media (max-width: 700px) {
      .main { padding: 18px 2vw; }
    }
  </style>

  <script>
    function applyTheme(theme) {
      document.body.classList.remove('theme-dark');
      if (theme === 'dark') {
        document.body.classList.add('theme-dark');
      } else if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('theme-dark');
      }
    }
    function applyFontSize(size) {
      document.body.classList.remove('font-small','font-medium','font-large','font-xlarge');
      document.body.classList.add(`font-${size}`);
    }
    function applyCompactMode(enabled) {
      document.body.classList.toggle('compact-mode', enabled);
    }
    document.addEventListener('DOMContentLoaded', () => {
      const theme    = localStorage.getItem('ld_theme')    || 'light';
      const fontSize = localStorage.getItem('ld_fontSize') || 'medium';
      const compact  = localStorage.getItem('ld_compact')  === 'true';
      applyTheme(theme);
      applyFontSize(fontSize);
      applyCompactMode(compact);
    });
  </script>
</head>
<body>

  <nav class="navbar">
      <a href="{{ url_for('index.index', token=request.args.get('token')) }}" class="logo-wiki d-flex align-items-center">
        <img src="{{ url_for('static', filename='assets/icon2.png') }}"
            alt="LuftDocs"
            width="64"
            height="64"
            class="me-2">
        <span>LuftDocs</span>
      </a>
    <div class="d-flex align-items-center">
      <a href="{{ url_for('index.index', token=request.args.get('token'), busca=1) }}"
         class="btn btn-outline-dark fw-bold me-3">
        <i class="bi bi-search"></i> Buscar
      </a>
      <div class="dropdown">
        <a class="btn btn-link text-dark p-0 dropdown-toggle" href="#" role="button"
           id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-person-circle" style="font-size: 1.7rem;"></i>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
          <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modalMinhaConta">
              Minha Conta
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modalConfiguracoes">
              Configura√ß√µes
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item" href="{{ url_for('index.logout') }}">
              üîì Logout
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Modal Minha Conta -->
  <div class="modal fade" id="modalMinhaConta" tabindex="-1" aria-labelledby="modalMinhaContaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalMinhaContaLabel">Informa√ß√µes da Conta</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Nome de Usu√°rio:</strong> {{ session['user_name'] }}</li>
            <li class="list-group-item"><strong>Email:</strong> {{ session['email'] }}</li>
            <li class="list-group-item"><strong>Grupo:</strong> {{ session['user_group']['acronym'] }}</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Configura√ß√µes -->
  <div class="modal fade" id="modalConfiguracoes" tabindex="-1" aria-labelledby="modalConfigLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">

        <div class="modal-header border-0">
          <h5 class="modal-title" id="modalConfigLabel">
            <i class="bi bi-gear-fill"></i> Configura√ß√µes
          </h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <ul class="nav nav-tabs mb-3" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#visuais" type="button">
                Visuais
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#operacoes" type="button">
                Opera√ß√µes
              </button>
            </li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane fade show active" id="visuais">
              <form id="formVisuais" class="row g-3">
                <div class="col-md-6">
                  <label for="selectTema" class="form-label">Tema</label>
                  <select id="selectTema" class="form-select">
                    <option value="light">Claro</option>
                    <option value="dark">Escuro</option>
                    <option value="auto">Autom√°tico</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="fontSize" class="form-label">Tamanho da Fonte</label>
                  <select id="fontSize" class="form-select">
                    <option value="small">Pequena</option>
                    <option value="medium">M√©dia</option>
                    <option value="large">Grande</option>
                    <option value="xlarge">Extra Grande</option>
                  </select>
                </div>
                <div class="col-12">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="switchCompactMode">
                    <label class="form-check-label" for="switchCompactMode">Modo Compacto</label>
                  </div>
                </div>
              </form>
            </div>
            <div class="tab-pane fade" id="operacoes">
              <form id="formOperacoes" class="row g-3">
                <div class="col-12 form-check">
                  <input class="form-check-input" type="checkbox" id="notifEmail">
                  <label class="form-check-label">Notifica√ß√µes por e-mail</label>
                </div>
                <div class="col-12 form-check">
                  <input class="form-check-input" type="checkbox" id="autoSave">
                  <label class="form-check-label">Auto-salvar buscas</label>
                </div>
                <div class="col-12">
                  <label for="futureFeatures" class="form-label">Recursos Futuro (Beta)</label>
                  <textarea id="futureFeatures" class="form-control" rows="2" placeholder="Sugest√µes..."></textarea>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-primary" id="btnSalvarConfigs">
            <i class="bi bi-save-fill"></i> Salvar
          </button>
        </div>

      </div>
    </div>
  </div>

  <!-- Modal Em Desenvolvimento -->
  <div class="modal fade" id="modalDev" tabindex="-1" aria-labelledby="modalDevLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-4">
        <i class="bi bi-tools fs-1 text-warning mb-3"></i>
        <h5 id="modalDevLabel">Ferramenta em Desenvolvimento</h5>
        <p>Em breve estar√° dispon√≠vel!</p>
        <button class="btn btn-primary mt-2" data-bs-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>

  <div class="main">
    {% block content %}{% endblock %}
  </div>

  <footer class="footer-LuftDocs">
    LuftDocs &copy; 2025 ‚Äî Feito para facilitar seu dia a dia.
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.5/viewer.min.js"></script>
  <script>
    // Preenche controles com valores salvos
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('selectTema').value       = localStorage.getItem('ld_theme')    || 'light';
      document.getElementById('fontSize').value         = localStorage.getItem('ld_fontSize') || 'medium';
      document.getElementById('switchCompactMode').checked = localStorage.getItem('ld_compact') === 'true';
    });

    // Salvar e aplicar configura√ß√µes
    document.getElementById('btnSalvarConfigs').addEventListener('click', () => {
      const theme   = document.getElementById('selectTema').value;
      const fontSz  = document.getElementById('fontSize').value;
      const compact = document.getElementById('switchCompactMode').checked;
      localStorage.setItem('ld_theme', theme);
      localStorage.setItem('ld_fontSize', fontSz);
      localStorage.setItem('ld_compact', compact);
      applyTheme(theme);
      applyFontSize(fontSz);
      applyCompactMode(compact);

      const toast = document.createElement('div');
      toast.className = 'toast align-items-center text-white bg-success border-0 position-fixed';
      toast.style.bottom = '1rem'; toast.style.right = '1rem';
      toast.setAttribute('role','alert');
      toast.setAttribute('aria-live','assertive');
      toast.setAttribute('aria-atomic','true');
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">Configura√ß√µes salvas! ‚úÖ</div>
          <button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>`;
      document.body.append(toast);
      new bootstrap.Toast(toast, { delay: 2000 }).show();
      bootstrap.Modal.getInstance(document.getElementById('modalConfiguracoes')).hide();
    });

    // Bloquear opera√ß√µes em DEV
    document.querySelectorAll('#formOperacoes input, #formOperacoes textarea').forEach(el => {
      el.addEventListener('focus', () => {
        new bootstrap.Modal(document.getElementById('modalDev')).show();
        el.blur();
      });
    });

    // Viewer.js
    document.addEventListener('DOMContentLoaded', () => {
      const viewerEl = document.getElementById('imagem-viewer');
      if (viewerEl) {
        new Viewer(viewerEl, {
          toolbar: true, navbar: false, title: false,
          movable: true, zoomable: true, scalable: false,
          rotatable: false, transition: true, fullscreen: true
        });
      }
    });
  </script>
</body>
</html>
