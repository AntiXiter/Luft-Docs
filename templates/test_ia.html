<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA de Teste - LuftDocs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; }
        .card { margin-top: 2rem; }
        #spinner { display: none; }
        #context-files { font-size: 0.8rem; max-height: 150px; overflow-y: auto; background-color: #e9ecef; }
        #iaResponse ul { padding-left: 20px; margin-top: 10px;}
        #iaResponse li { margin-bottom: 5px; }
        #iaResponse h2 { font-size: 1.2rem; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        #iaResponse img { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header text-center bg-primary text-white">
                <h2>üß™ LIA IA (BETA)</h2>
            </div>
            <div class="card-body">
                <p class="card-text">A "Lia" agora l√™ todos os arquivos do projeto para criar o contexto. Fa√ßa sua pergunta abaixo!</p>
                
                <div class="mb-3">
                    <label for="userQuestion" class="form-label"><strong>Sua Pergunta:</strong></label>
                    <input type="text" class="form-control" id="userQuestion" placeholder="Ex: Como √© a tela do recebimento INTEC?">
                </div>

                <div class="mb-3">
                    <label for="modelSelector" class="form-label"><strong>Escolha o Modelo da IA:</strong></label>
                    <select class="form-select" id="modelSelector">
                        <option value="groq-70b" selected>Groq (Llama 3 70b - Poderoso)</option>
                        <option value="groq-8b">Groq (Llama 3 8b - Super R√°pido)</option>
                        <option value="gemini">Gemini (1.5 Flash - Google)</option>
                        <option value="openai" disabled>OpenAI (GPT-4o - Requer Cr√©dito)</option>
                    </select>
                </div>
                </div>
                <div class="d-grid">
                    <button class="btn btn-success btn-lg" id="askButton">
                        <span id="spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Perguntar √† Lia
                    </button>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <strong>Resposta da Lia:</strong>
                    </div>
                    <div class="card-body" id="iaResponse">
                        <p class="text-muted">A resposta aparecer√° aqui...</p>
                    </div>
                    <div class="card-footer" id="context-info" style="display: none;">
                        <small><strong>Contexto utilizado (arquivos lidos):</strong></small>
                        <div id="context-files" class="list-group list-group-flush p-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const askButton = document.getElementById('askButton');
        const userQuestionInput = document.getElementById('userQuestion');
        const modelSelector = document.getElementById('modelSelector'); // MUDAN√áA: Pega o seletor
        const iaResponseDiv = document.getElementById('iaResponse');
        const spinner = document.getElementById('spinner');
        const contextInfo = document.getElementById('context-info');
        const contextFilesDiv = document.getElementById('context-files');

        askButton.addEventListener('click', async () => {
            const userQuestion = userQuestionInput.value;
            const selectedModel = modelSelector.value; // MUDAN√áA: Pega o valor do modelo selecionado

            if (!userQuestion.trim()) {
                alert('Por favor, fa√ßa uma pergunta.');
                return;
            }

            spinner.style.display = 'inline-block';
            askButton.disabled = true;
            iaResponseDiv.innerHTML = `<p class="text-muted">A Lia est√° pensando com o motor do ${selectedModel.toUpperCase()}...</p>`;
            contextInfo.style.display = 'none';
            contextFilesDiv.innerHTML = '';

            try {
                const response = await fetch('/api/ask_llm', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    // MUDAN√áA: Envia a pergunta E o modelo escolhido para a API
                    body: JSON.stringify({ 
                        user_question: userQuestion,
                        selected_model: selectedModel 
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    iaResponseDiv.innerHTML = marked.parse(data.answer); 
                    if (data.context_files && data.context_files.length > 0) {
                        data.context_files.forEach(file => {
                            const fileElement = document.createElement('div');
                            fileElement.className = 'list-group-item py-1';
                            fileElement.textContent = file;
                            contextFilesDiv.appendChild(fileElement);
                        });
                        contextInfo.style.display = 'block';
                    }
                } else {
                    iaResponseDiv.innerHTML = `<p class="text-danger"><strong>Erro:</strong> ${data.error}</p>`;
                }
            } catch (error) {
                iaResponseDiv.innerHTML = `<p class="text-danger"><strong>Erro de conex√£o.</strong> Verifique o console do servidor.</p>`;
            } finally {
                spinner.style.display = 'none';
                askButton.disabled = false;
            }
        });
    </script>
</body>
</html>